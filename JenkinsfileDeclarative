pipeline{

    agent any

    tools {
     maven 'maven3.6.2'
    }

    options{
        //Add the timestamp to the console output
        timestamps()
        //Discard old buids
        buildDiscarder(logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '3', daysToKeepStr: '', numToKeepStr: '3'))
    }
    stages{

      stage('CheckOutCode'){
        steps{
 	        git branch: 'krishna', credentialsId: 'dda4164d-b839-423d-9d4e-ebf5676b26a9', url: 'https://github.com/frameworksselenium/live-execution-dashboard.git'
        }
      }
      stage('Build'){
       steps{
        sh "mvn clean -DskipTests=true package"
       }
      }
      stage('ExecuteUnitTestAndSonarqubeReport'){
        steps{
            sh "mvn -Dtest=ServiceUnitTest test install sonar:sonar"
        }
      }
      stage('UploadArtifactsintoNexus'){
        steps{
            sh "mvn -DskipTests=true deploy"
        }
      }
      stage('DeployAppIntoTomcatServer'){
        steps{
            sshagent(['82acc154-3acf-4823-9d01-d7ade13f5d57']) {
                sh "scp -o StrictHostKeyChecking=no target/live-execution-dashboard-0.0.1-SNAPSHOT.jar ec2-user@18.206.176.58:/live-app"
            }

        }
      }
      stage('FunctionalTesting'){
        steps{
            sh "mvn test -Dtest=IntegrationTest"
        }
      }
      stage('PerformanceTesting'){
          steps{
              sh "mvn test -Dtest=IntegrationTest"
          }
      }
    }

}
