pipeline{

    agent any

    tools {
     maven 'maven3.6.2'
    }

    options{
        //Add the timestamp to the console output
        timestamps()
        //Discard old buids
        buildDiscarder(logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '3', daysToKeepStr: '', numToKeepStr: '3'))
    }
    stages{

      stage('CheckOutCode'){
        steps{
 	        git branch: 'krishna', credentialsId: 'dda4164d-b839-423d-9d4e-ebf5676b26a9', url: 'https://github.com/frameworksselenium/live-execution-dashboard.git'
        }
      }
      stage('Build'){
       steps{
        sh "mvn clean package"
       }
      }
      stage('ExecuteSonarqubeReport'){
        steps{
            sh "mvn sonar:sonar"
        }
      }
      stage('UnitTesting'){
          steps{
              sh "mvn -Dtest=ServiceUnitTest test"
          }
      }
      stage('UploadArtifactsintoNexus'){
        steps{
            sh "mvn deploy"
        }
      }
      stage('DeployAppIntoTomcatServer'){
        steps{
            sshagent(['ed833a5b-4248-40cd-b77a-1c4699baaedd']) {
                sh "scp -o StrictHostKeyChecking=no target/live-execution-dashboard-0.0.1-SNAPSHOT.jar ec2-user@18.206.176.58:/opt/apache-tomcat-9.0.64/webapps/"
            }
        }
      }
      stage('FunctionalTesting'){
        steps{
            sh "mvn test -Dtest=IntegrationTest"
        }
      }
      stage('PerformanceTesting'){
              steps{
                  sh "mvn test -Dtest=IntegrationTest"
              }
            }
    }

}
